<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
    <title>근무관리시스템 관리자화면</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <!-- Custom styles for this template -->
    <link href="css/styles.css" rel="stylesheet">
    <script src="node_modules/jquery/dist/jquery.js"></script>
    <script src="js/jquery.messagebox.js"></script>

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <script type="text/javascript">
        var msg;
        jQuery( document ).ready( function( $ ) {    
          $( "#startDate" ).datepicker({ dateFormat: 'yy-mm-dd' });
          $( "#endDate" ).datepicker({ dateFormat: 'yy-mm-dd' });

            var _url;
            if($("#role").val() == '1') {
              _url = '/userAll'
            }else{
              _url = '/userFind'
            }

            $.ajax({
                url: _url,
                type: 'POST',
                data: {id:$("#userId").val()},
                success : function(data) {
                  var _userList = "<option value='init'>사용자선택</option>";
                  for(var i=0; i< data.userList.length; i++) {
                    _userList += "<option value='" + data.userList[i].id + "'>" 
                                     + data.userList[i].name + "</option>";
                  }
                  $("#sel_userList").html(_userList);
                },
                error : function() {				
                  alert("사용자 정보 리스트 취득 실패");
                }
            });

            $("#excelExport").click(function(){
              $.ajax({ 
                      type: "POST",
                      url: "/ExcelExport", 
                      data:$("form[name=target]").serialize(),
                      // 엑셀 다운로드 관련 미들웨어로 url 
                      success: function(resp){ 
                        if(!resp.result) { 
                          alert('엑셀 다운로드 중 문제가 발생했습니다.'); 
                          return false; 
                        } 
                        let excelUri = "data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,"; 
                        let excelUrl = excelUri + resp.content; 
                        // resp.content는 엑셀 데이터입니다. 
                        let filename = '근무표' 
                        // 다운받는 파일의 이름 지정 
                        setTimeout(function () { 
                          var a = document.createElement("a");
                           a.href = excelUrl; 
                           a.download = filename;
                            a.click(); 
                        }, 100); 
                      } 
                    });
              });
          });
    </script>
  </head>

  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">출퇴근관리시스템 관리자페이지</a>
          <div class="navbar-brand">[ <%=projectNm %> ]</div>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="/logout">로그아웃</a></li>
          </ul>          
        </div>
      </div>
    </nav>    
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
          <ul class="nav nav-sidebar">
            <li><a href="/workInfo">Overview</a></li>
            <li><a href="/workUsers">상세정보관리</a></li>
            <li><a href="/workVac">휴가신청</a></li>
            <li><a href="#">기초코드등록</a></li>
            <li class="active"><a href="#">Export<span class="sr-only">(current)</span></a></li>
          </ul>
        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
          <h1 class="page-header">데이터 추출 및 리포트</h1>
          <input type="hidden" id="role" name="role" value=<%= role %>>
          <input type="hidden" id="userId" name="userId" value=<%= userId %>>
         
          <div class="container" style="margin-left: -10mm;">
            <form id="target" name="target">	
              <div style="border: 4px dashed #bcbcbc;">		
                <label style="font-size: x-large; margin-left: 3ch;">[출력기간] </label>
                <div style="font-size: x-large; margin-left: 3ch;">
                  시작일자 : <input type="text" id="startDate" name="startDate" style="width: 150px;" >
                  종료일자 : <input type="text" id="endDate" name="endDate" style="width: 150px;" >
                </div>

                <div class="form-group" style="width:350px">
                  <label style="font-size: x-large; margin-left: 3ch;">[대상자] </label>
                  <select id="sel_userList" class="form-control" name="selUserList" style="width:300px; margin-left: 6ch;font-size: large;">							
                  </select>
                </div>
              </div>
            </form>
            <br/>
            <br/>
            <br/>

            <div class="form-group" style="width:350px; float:left;">
              <label style="font-size: x-large;">프로젝트 출근부 파일 다운로드 </label>              
            </div>      
            <div class="form-group" style="width:350px; float:left;">
              <button type="button" id="excelExport" class="btn btn-default" style="width:80px;">출력</button>
            </div>      
        </div>
      </div>
    </div>
  </body>
</html>
